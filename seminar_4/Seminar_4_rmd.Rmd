---
title: "PSZB17-210 - Seminar_4"
author: "Zoltan Kekecs"
date: "September 28, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# 4. Ora - Adatexploracio

Az ora celja az adatexploracios modszerek elsajatitasa.

## Package-ek betoltese

A kovetkezp package-ekre lesz szuksegunk

```{r packages, echo=T, results='hide', message=F, warning=F}
if (!require("tidyverse")) install.packages("tidyverse")
library(tidyverse) # for dplyr and ggplot2
if (!require("psych")) install.packages("psych")
library(psych) # for describe
```

## Adatok betoltese

Beolvassuk az orai kerdoiv adatait a read_csv funkcioval, es elmentjuk egy orai_adat nevu objektumba. A read_csv funkcio a tidyverse resze, es egybol tibble formatumban menti el az adatainkat

```{r load_data, results='hide', message=F, warning=F}
orai_adat <- read_csv("https://raw.githubusercontent.com/kekecsz/PSZB17-210-Data-analysis-seminar/master/seminar_4/Orai_kerdoives_adatok%20-%20ora_1_3.csv")

```

## Adatok attekintese

A tibble objektum meghivasaval kapthatunk nemi informaciot az adattabla szerkezeterol. Lathatjuk hany sor es hany oszlop van az adattablaban, es lathatjuk milyen class-ba tartoznak (chr, dbl ...)

```{r initial exploration 1}
orai_adat
```

Ha az egyes valtozok leirostatisztikaira (descriptive statistics) vagyunk kivancsiak, kerhetjuk ezt a mar tanult modon.

Peldaul lekerhetjuk a valtozo alapveto legalacsonyabb es legmagasabb erteket, atlagat, medianjat, a kvartiliseket, es hogy hany hianyzo adat van (ha van) a summary() funkcioval (miutan a select funkcioval kivalasztottuk, melyik valtozora vagyunk kivancsiak)

```{r initial exploration 2}
orai_adat %>% 
  select(jegy_tipp) %>% 
  summary()
```

Vagy megkapthatjuk ugyanezt az osszes valtozora, ha ugyanezt az egesz adattablara futtatjuk le. Persze a karakter osztalyba tartozo valtozoknal mindezeknek a leiro statisztikaknak nincs ertelme, ott csak a class informaciot kaptjuk az output-ban.

```{r initial exploration 3, results='hide'}
orai_adat %>% 
  summary()
```

*______________________________* 

### Gyakorlas

- Hany orat gyakorolt az az ember, aki a legtobb orat gyakorolta a masodik es a harmadik ora kozott (*stat_gyakorlas_3* valtozo)?
- Mekkora volt az atlagos energiaszint az elso es mekkora a haramdik oran (*energiaszint_1* es *energiaszint_3* valtozok)? 

*______________________________*



## Megtobb leiro statisztika

A Psych package segitsegevel a describe() funkcio megtobb hasznos informaciot adhat

```{r initial Psych explore, message=F, warning=F}
describe(orai_adat)
```


*______________________________* 

### Gyakorlas

- Mi a statisztika gyakorlas ferdesegi mutatoja (skew/skewness) (*stat_gyakorlas_3* valtozo)?
- Hanyan valaszoltak az energia szint kerdesre az elso es a harmadik oran (*energiaszint_1* es *energiaszint_3* valtozok)? 

*______________________________*



## Faktorok

Nehany karaktervaltozonak csak korlatozott mennyisegu eleme lehet, mint peldaul a nem (ferfi, no, egyeb), vagy az eletkor (0-22 vagy 23+) a mi kerdoivunkben. Ezeket megjelolhetjuk faktor (factor) osztalyu valtozokent, es akkor az R tobb informaciot fog adni rola.

A levels() funkcio megmutatja mik a faktorunk szintjei, de lathato ez akkor is ha csak meghivjuk a valtozot magat.

A table() funkcio pedig tablazatot keszit arrol, hogy az egyes csoportokban hany megfigyeles talalhato

```{r initial specify as factor}
orai_adat <- orai_adat %>% 
              mutate(nem = factor(nem), 
                     eletkor = factor(eletkor),
                     memoriateszt_hely = factor(memoriateszt_hely))

levels(orai_adat$nem)

orai_adat$nem

table(orai_adat$eletkor)
table(orai_adat$nem)

```



Igy mar a fenti summary() funkcio is kiadja az egyes faktorszintekrol (no, ferfi) hogy hanyan tartoznak oda.

```{r initial summarize factor}
orai_adat %>%
  select(nem) %>% 
  summary()
```


Van, hogy szeretnenk kizarni bizonyos faktorszinteket az elemzesbol. Pl. ha valamelyik faktor szintbol nagyon keves megfigyeles van, mondjuk 23 even feluli eletkoruakbol, oket lehet hogy szeretnenk kizarni a kesobbi elemzesekbol hogy egyszerusitsuk az eredmenyeink ertelmezeset. Ezt a mar korabban tanult filter() funkcio segitsegevel konnyeden megtehetjuk, azonban arra figyelnunk kell, hogy az R megjegyzi a faktorszinteket, es azt azt kovetoen is a valtozohoz rendelve tartja, miutan mar az adott faktorszintbol nincs egy megifgyeles sem az adattablaban. 

```{r initial droplevels 1}
orai_adat %>%
  filter(eletkor != "23+") %>% 
  select(eletkor) %>% 
  summary()
```

Igy ezeket a szinteket ejteni szoktuk a droplevels() funkcioval.

```{r initial droplevels 2}
orai_adat %>%
  filter(eletkor != "23+") %>% 
  select(eletkor) %>% 
  droplevels() %>% 
  summary()
```

Elofordul, hogy egy folytonos valtozot akarunk atalakitani faktorra, pl. elkepzelheto hogy ossze akarjuk hasonlitani azokat akik 6 vagy kevesebb orat alszanak altalaban azokkal akik 7 vagy 8, vagy meg tobb orat alszanak. 

```{r factors recode plot}
orai_adat %>%
  ggplot() +
  aes(x = alvas_altalaban_1) +
  geom_bar() +
  geom_vline(xintercept = c(6.5, 8.5), linetype="dashed", 
                color = "red", size=1.5)

```

Ilyenkor hasznalhatjuk a mutate() es recode() funkciok kombinaciojat hogy csinaljunk egy uj valtozot. Ebbe a kodba beleepitettem a factor() funkciot is, hogy azonnal meghatarozzuk, hogy ez az uj valtozo egy faktor, es nem egy egyszeru karaktervektor. A factor() funkcio nelkul is lefut a kod, de akkor meg kellene egy kulon sor ahol megadjuk hogy ez egy faktorvaltozo.

```{r factors recode}
orai_adat = orai_adat %>%
  mutate(alvas_altalaban_kat_1 = factor(recode(alvas_altalaban_1,
                                        "5" = "keves",
                                        "6" = "keves",
                                        "7" = "eleg",
                                        "8" = "eleg",
                                        "9" = "sok")))


levels(orai_adat$alvas_altalaban_kat_1)

```

### Faktorszintek sorrendje, ordinalis valtozok

Amikor van ertelme a sorrendisegnek a faktorszintek kozott, ordinalis valtozokrol beszelunk (vagyis az egyik faktorszint alacsonyabb, vagy kisebb "erteku" mint a masik). Arra figyelnunk kell, hogy amikor faktorokat hozunk letre, az R automatikusan a faktorszintek neveinek ABC sorrendje alapjan rakja oket sorba, es az abrakon is igy szemlelteti majd oket.

```{r factors order plot 1}
orai_adat %>%
  ggplot() +
  aes(x = alvas_altalaban_kat_1) +
  geom_bar()

```

Ilyenkor erdemes meghatarozni a faktorszintek sorrendjet (order). Ezt legegyszerubben a factor() funkcion belul tehetjuk meg, az ordered = T beallitasaval, es a levels = resznel a szintek sorrendjenek meghatarozasaval.

```{r factors order}
orai_adat = orai_adat %>%
mutate(alvas_altalaban_kat_1 = factor(alvas_altalaban_kat_1, ordered = T, levels = c(
                                          "keves",
                                           "eleg",
                                           "sok")))

```

Igy mar az R minden funkcioja tudni fogja, hogy egy ordinalis valtozorol van szo, ahol fontos a sorrend, es tudni fogja a sorrendet is.

```{r factors order plot 2}
orai_adat %>%
  ggplot() +
  aes(x = alvas_altalaban_kat_1) +
  geom_bar()
```



*______________________________* 

### Gyakorlas

- Hatarozd meg az elso orai hangulat atlagat (*hangulat_1* valotzo).


- Csinalj egy kategorikus valtozot az elso orai hangulat alapjan ugy, hogy harom csoport alakuljon ki: 0-3 - rossz, 4-6 - kozepes, 7-10 - jo. (Emlekeztetoum: ezt a mutate() es a recode() funkciokkal tudod peldaul elerni.) Ezt az uj valtozot nevezd el *hangulat_kat_1* -nek, es az ezt az uj valtozot is tartalmazo adattablat mentsd el *orai_adat_harmashangulat_1* neven.


- Fontos, hogy a *hangulat_kat_1* valtozot faktor valotozokent jelold meg. (Ezt lehet az elozo lepesben a mutate() funkcion belul, vagy egy kulon lepesben, de mindenkeppen a factor() vagy az as.factor() funkciokat erdemes hozza hasznalni)


- Keszits egy tablazatot arrol, hogy hanyan esnek a *hangulat_kat_1* egyes kategoriaiba.


- Add meg a faktorszintek helyes sorrendjet: rossz, kozepes, jo (Ird felul a *hangulat_kat_1* korabbi valtozatat ezzel a valtozattal ahol a szintek mar helyes sorrendben vannak)


- Nezd meg a faktor szintjeit, hogy valoban helyes sorrendben szerepelnek-e


*______________________________*


```{r pelda megoldas}

orai_adat %>% 
  select(hangulat_1) %>% 
  summary()

orai_adat_harmashangulat_1 <- orai_adat %>% 
  mutate(hangulat_kat_1 = factor(recode(hangulat_1,
                                 "0" = "rossz",
                                 "1" = "rossz",
                                 "2" = "rossz",
                                 "3" = "rossz",
                                 "4" = "kozepes",
                                 "5" = "kozepes",
                                 "6" = "kozepes",
                                 "7" = "jo",
                                 "8" = "jo",
                                 "9" = "jo",
                                 "10" = "jo"
                                 ), ordered = T, levels = c("rossz", "kozepes", "jo")))
  
table(orai_adat_harmashangulat_1$hangulat_kat_1)

orai_adat_harmashangulat_1 %>% 
  select(hangulat_kat_1) %>% 
  summary


```



## Exploracio vizualizacion keresztul

### egyes valtozok vizualizacioja

Az egyes valtozok grafikonok (plot) segitsegevel is megvizsgalhatok.
A kategorikus valtozokat gyakran oszlopdiagrammal (geom_bar) abrazoljuk, mig a folytonos valtozokat inkabb histogram vagy density plot segitsegevel szoktuk abrazolni.

Az egyes valtozok vizualizacioja es a leiro statisztikak atvizsgalasa elengedhetetlen hogy azonositsuk az esetleges adatbeviteli hibakat es egyeb nemvart furcsasagokat az adataink kozott.

Mindig ellenorizd az adataidat ezekkel a modszerekkel mielott komolyabb adatelemzesbe kezdesz, hogy meggyozodj rola, hogy az adatok tisztak es megfelenek az elvarasaidnak.


```{r plot single variable}
orai_adat %>%
ggplot() +
  aes(x = memoriateszt_hely) +
  geom_bar()

orai_adat %>%
ggplot() +
  aes(x = cipomeret) +
  geom_histogram()

orai_adat %>%
ggplot() +
  aes(x = cipomeret) +
  geom_density()

```

*______________________________* 

### Gyakorlas

Hasznald a fent tanult modszereket, hogy azonositsd az orai_adat adattablaban levo hibakat vagy nem vart furcsasagokat.

- A vizualizacion tul a View(), describe(), es summary() funciokat erdemes hasznalni az adatok elso attekintesere 
- A folytonos valtozoknal vizsgald meg a minimum es maximum erteket es a hianyzo adatok mennyiseget, valamint az eloszlast.
- A kategorikus valtozoknal vizsgald meg az osszes faktorszintet es az egyes szintekhez tartozo megfigyelesek mennyiseget.


```{r pelda megoldas 2, message=F, warning=F}
# View(orai_adat)

describe(orai_adat)

orai_adat %>% 
  summary()

orai_adat %>% 
  ggplot()+
    aes(x = szocmedia_3)+
    geom_bar()


orai_adat %>% 
  ggplot()+
    aes(x = magassag)+
    geom_histogram()



orai_adat %>%
  filter(magassag>2) %>% 
  ggplot()+
    aes(x = cipomeret, y = magassag)+
    geom_point() +
    geom_smooth()





```

A hibakat a kovetkezokeppen javithatjuk.
A filter() funkcioval kivalaszthatjuk a kerdeses esetet es valtozot, majd a mutate() funkcioval azt az egy erteket megvaltoztathatjuk. Azt, hogy ilyenkor hianyzo adatra, vagy egy masik, valoszinu ertekre kell megvaltoztatni az erteket, a szituaciotol fogg. Altalaban a biztosabb megoldas ha hianyzo adatnak jeloljuk a kerdeses erteket (NA), de ez sok adatveszteshez vezethet. Ha eleg valszinu hogy mi a helyes valasz, beirhatjuk. 

Minden javitast fel kell tuntetni a kutatasi jelentesben (es a ZH soran is), hogy az olvaso szamara tiszta legyen, hogy itt egy adathelyettesites vagy kizaras tortent.



```{r pelda megoldas correction, message=F, warning=F}
orai_adat_corrected = orai_adat %>%
  filter(szocmedia_3 == "youtube") %>% 
  mutate(szocmedia_3 = NA)

orai_adat_corrected = orai_adat_corrected %>%
  filter(magassag == 1.82) %>% 
  mutate(magassag = 182)

orai_adat_corrected = orai_adat_corrected %>%
  filter(cipomeret == 47) %>% 
  mutate(cipomeret = 37)

```

*______________________________*


## Tobb valtozo kapcsolatanak felterkepezese


Tobb valtozo kapcsolatat is felterkepezhetjuk abrak segitsegevel

```{r plot multiple variables}
orai_adat %>%
ggplot() +
  aes(x = memoriateszt_hely, y = magassag) +
  geom_boxplot()

```




*______________________________* 


# Hazi feladat



- Hatarozd meg az elso orai hangulat atlagat (*hangulat_1* valotzo).


- Csinalj egy kategorikus valtozot az elso orai hangulat alapjan ugy, hogy harom csoport alakuljon ki: 0-3 - rossz, 4-6 - kozepes, 7-10 - jo. (Emlekeztetoum: ezt a mutate() es a recode() funkciokkal tudod peldaul elerni.) Ezt az uj valtozot nevezd el *hangulat_kat_1* -nek, es az ezt az uj valtozot is tartalmazo adattablat mentsd el *orai_adat_harmashangulat_1* neven.


- Fontos, hogy a *hangulat_kat_1* valtozot faktor valotozokent jelold meg. (Ezt lehet az elozo lepesben a mutate() funkcion belul, vagy egy kulon lepesben, de mindenkeppen a factor() vagy az as.factor() funkciokat erdemes hozza hasznalni)


- Keszits egy tablazatot arrol, hogy hanyan esnek a *hangulat_kat_1* egyes kategoriaiba.


- Add meg a faktorszintek helyes sorrendjet: rossz, kozepes, jo (Ird felul a *hangulat_kat_1* korabbi valtozatat ezzel a valtozattal ahol a szintek mar helyes sorrendben vannak)


- Nezd meg a faktor szintjeit, hogy valoban helyes sorrendben szerepelnek-e


- Keszits egy ujabb adat objektumot, amiben nincsenek benne a rossz hangulatuak (mondjuk a filter() segitsegevel), mondjuk legyen a neve *orai_adat_harmashangulat_1_rossznelkul*


- Ejtsd a nem hasznalt faktorszinteket (a droplevels() funkcioval). (Ird felul a *orai_adat_harmashangulat_1_rossznelkul$hangulat_kat_1* korabbi valtozatat ezzel az modositott valatozoval, ahol mar nincsenek meg a felesleges szintek)
